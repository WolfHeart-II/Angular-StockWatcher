"use strict";angular.module("stockWatcher.Controllers",[]),angular.module("stockWatcher.Directives",[]),angular.module("stockWatcher.Filters",[]),angular.module("stockWatcher.Providers",[]),angular.module("stockWatcher.Services",[]),angular.module("stockWatcher",["ngRoute","ngAnimate","stockWatcher.Controllers","stockWatcher.Directives","stockWatcher.Services","stockWatcher.Providers","stockWatcher.Filters"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/home-page.html",controller:"HomePageController"}).when("/about",{templateUrl:"views/about-page.html",controller:"AboutPageController"}).when("/quote/:stockSymbol",{templateUrl:"views/quoteDetails-page.html",controller:"QuoteDetailsPageController"}).when("/currency",{templateUrl:"views/currency-page.html",controller:"CurrencyPageController"}).otherwise({redirectTo:"/"})}]).config(function(){String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(r,t){return"undefined"!=typeof e[t]?e[t]:r})})}).run(["$window","$rootScope",function(e,r){var t=!0;navigator&&navigator.onLine&&(t=navigator.onLine),r.$apply(function(){r.applicationIsOnline=t}),e.addEventListener?(e.addEventListener("online",function(){r.$apply(function(){r.applicationIsOnline=!0})},!1),e.addEventListener("offline",function(){r.$apply(function(){r.applicationIsOnline=!1})},!1)):(document.body.ononline=function(){r.$apply(function(){r.applicationIsOnline=!0})},document.body.onoffline=function(){r.$apply(function(){r.applicationIsOnline=!1})})}]).run(["$window","$rootScope",function(){"undefined"!=typeof Highcharts&&Highcharts.setOptions({global:{useUTC:!1}})}]),angular.module("stockWatcher.Controllers").controller("AboutPageController",["$scope",function(e){e.controllerVersion="0.0.1"}]),angular.module("stockWatcher.Controllers").controller("CurrencyChartController",["$scope","$interval","$timeout","currencyService",function(e,r,t,o){e.refreshInterval=60;var a="container"+e.fromCurrency+e.toCurrency;e.containerID=a;var n=void 0,s=void 0;e.fetchPreviousDayClosePrice=function(){var r=[e.symbol],t=stockService.getCurrentDataWithDetails(r);t.then(function(e){e.query.count>0&&(n=e.query.results.row.PreviousClose,"undefined"!=typeof n&&f())})};var i=function(r){s=new Highcharts.StockChart({chart:{renderTo:a},title:{text:e.fromCurrency+" to "+e.toCurrency},credits:{enabled:!1},rangeSelector:{buttons:[{type:"day",count:1,text:"1d"},{type:"day",count:2,text:"2d"},{type:"day",count:7,text:"5d"},{type:"all",text:"All"}],selected:0,allButtonsEnabled:!0},series:[{name:e.fromCurrency+" to "+e.toCurrency,type:"area",data:r,gapSize:5,tooltip:{valueDecimals:4},fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]},threshold:null}]}),"undefined"!=typeof n&&f()},l=function(){v(),i([null]),s.showLoading()};t(l,0);var c=e.fromCurrency,d=e.toCurrency,u=180,h="10d",v=function(){var e=o.getCurrencyExchangeRateHistory(c,d,u,h);e.then(function(e){e&&e.length>0?(s.hideLoading(),i(e)):(console.warn('"'+c+"-"+d+'" init did not receive data, refreshing it.'),v())})},g=function(){var e=o.getCurrencyExchangeRateHistory(c,d,u,h);e.then(function(e){e&&e.length>0?p(e):(console.warn('"'+c+"-"+d+'" update did not receive data, refreshing it.'),g())})},p=function(e){var r=s.series[0];r.setData(e),"undefined"!=typeof n&&f(),s.redraw()},f=function(){var r=e.fromCurrency+e.toCurrency,t=n;if(s){var o=r+"-open",a=s.yAxis[0];a.removePlotLine(o),a.addPlotLine({color:"red",dashStyle:"LongDash",id:o,label:{text:"Prev Close ($"+t+")"},width:1,zIndex:3,value:t})}};e.createRefresher=function(){return r(function(){g()},1e3*e.refreshInterval)},e.destroyRefresher=function(){"undefined"!=typeof e.refresher&&(r.cancel(e.refresher),e.refresher=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()},e.refresher=e.createRefresher(),e.$on("$destroy",function(){e.destroyRefresher(),"undefined"!=typeof s&&s.destroy()})}]),angular.module("stockWatcher.Controllers").controller("CurrencyPageController",["$scope",function(e){e.controllerVersion="0.0.1"}]),angular.module("stockWatcher.Controllers").controller("HomePageController",["$scope",function(e){e.controllerVersion="0.0.1"}]),angular.module("stockWatcher.Controllers").controller("MarketChartController",["$scope","$interval","stockService","errorMessages",function(e,r,t,o){e.refreshInterval=60,e.chartIsInitialized=!1;var a="containerMarkets";e.containerID=a;var n=void 0,s=void 0,i=[{symbol:".INX",name:"S&P 500",data:[]},{symbol:".DJI",name:"Dow Jones",data:[]},{symbol:"OSPTX",name:"S&P/TSX",data:[]}],l={title:"TSX, Dow Jones & S&P500 Indices"},c=function(){s=new Highcharts.StockChart({chart:{renderTo:a},title:{text:l.title},credits:{enabled:!1},xAxis:{events:{setExtremes:function(){}}},rangeSelector:{buttons:[{type:"day",count:1,text:"1d"},{type:"day",count:2,text:"2d"},{type:"day",count:7,text:"5d"},{type:"all",text:"All"}],selected:0,allButtonsEnabled:!0},series:i,plotOptions:{series:{compare:"percent"}},yAxis:{labels:{formatter:function(){return(this.value>0?" + ":"")+this.value+"%"}},plotLines:[{value:0,width:2,color:"silver"}]},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',valueDecimals:2}}),"undefined"!=typeof n&&f(),e.chartIsInitialized=!0},d=60,u="10d",h=0,v=function(){for(var e=0,r=i.length;r>e;e++){var a=i[e].symbol;console.log("MarketChartController::initGraph() sent data request for index #"+e+': "'+i[e].name+'"');var n=t.getLiveMarketData(a,d,u);n.then(function(e){return function(t){h++,console.log("for #"+e+", got",t.length),t&&t.length>0&&(console.log("MarketChartController::initGraph() received data for index #"+e+': "'+i[e].name+'"'),i[e].data=t,h===r&&(console.log("MarketChartController::initGraph() received all expected data. Creating graph..."),c()))}}(e),function(e){return function(t){h++,console.error("Error while receiving data for serie #"+e,t),t&&t.error&&t.error===o.NoData.Error&&h===r&&c()}}(e))}};v();var g=function(){if("undefined"!=typeof s)for(var e=0,r=i.length;r>e;e++){var o=i[e].symbol;console.log("MarketChartController::updateGraph() sent data request for index #"+e+': "'+i[e].name+'"');var a=t.getLiveMarketData(o,d,u);a.then(function(e){return function(r){r&&r.length>0?(console.log("MarketChartController::updateGraph() received data for index #"+e+': "'+i[e].name+'"'),p(e,r)):(console.warn('"'+i[e].name+'" update did not receive data, refreshing it.'),g())}}(e),function(e){console.error(e)})}},p=function(e,r){var t=s.series[e];t.setData(r),"undefined"!=typeof n&&f()},f=function(){var r=e.fromCurrency+e.toCurrency,t=n;if(s){var o=r+"-open",a=s.yAxis[0];a.removePlotLine(o),a.addPlotLine({color:"red",dashStyle:"LongDash",id:o,label:{text:"Prev Close ($"+t+")"},width:1,zIndex:3,value:t})}};e.createRefresher=function(){return r(function(){g()},1e3*e.refreshInterval)},e.destroyRefresher=function(){angular.isDefined(m)&&(r.cancel(m),m=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()};var m=e.createRefresher();e.$on("$destroy",function(){e.destroyRefresher(),"undefined"!=typeof s&&s.destroy()}),e.$parent.$watch("showTitle",function(e){"undefined"!=typeof s&&(s.setTitle(e?{text:l.title}:{text:null}),s.reflow(),s.redraw())}),e.$parent.$watch("showZoom",function(e){"undefined"!=typeof s&&(s.rangeSelector.enabled=e,s.reflow(),s.redraw())}),e.$parent.$watch("showDatePicker",function(){}),e.$parent.$watch("showNavigator",function(e){if("undefined"!=typeof s){var r=s.scroller;e?(r.xAxis.labelGroup.show(),r.xAxis.gridGroup.show(),r.series.show(),r.navigatorGroup.show(),r.scrollbar.show(),r.scrollbarRifles.show(),r.scrollbarGroup.show(),$.each(r.elementsToDestroy,function(e,r){r.hide()})):(r.xAxis.labelGroup.hide(),r.xAxis.gridGroup.hide(),r.series.hide(),r.scrollbar.hide(),r.scrollbarGroup.hide(),r.scrollbarRifles.hide(),r.navigatorGroup.hide(),$.each(r.elementsToDestroy,function(e,r){r.hide()})),s.reflow(),s.redraw()}})}]),angular.module("stockWatcher.Controllers").controller("MarketChartWidgetController",["$scope",function(e){e.showTitle=!0,e.showZoom=!0,e.showDatePicker=!0,e.showNavigator=!0,e.toggleTitle=function(){e.showTitle=!e.showTitle},e.toggleZoom=function(){e.showZoom=!e.showZoom},e.toggleDatePicker=function(){e.showDatePicker=!e.showDatePicker},e.toggleNavigator=function(){e.showNavigator=!e.showNavigator}}]),angular.module("stockWatcher.Controllers").controller("QuoteDetailsPageController",["$scope","$interval","$routeParams","$location","stockService",function(e,r,t,o,a){e.controllerVersion="0.0.1",e.$location=o,e.stockSymbol=t.stockSymbol,e.refreshInterval=30;var n=function(){var r=[e.stockSymbol],t=a.getCurrentDataWithDetails(r);t.then(function(r){e.stockData=r.query.results.row})};n(),e.createRefresher=function(){return r(function(){n()},1e3*e.refreshInterval)},e.destroyRefresher=function(){angular.isDefined(s)&&(r.cancel(s),s=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()};var s=e.createRefresher();e.$on("$destroy",function(){e.destroyRefresher()})}]),angular.module("stockWatcher.Controllers").controller("RouteController",["$scope","$route","$location",function(e,r){e.$on("$routeChangeSuccess",function(){e.controller=r.current.controller})}]),angular.module("stockWatcher.Controllers").controller("StockChartController",["$scope","$interval","$timeout","stockService","errorMessages",function(e,r,t,o,a){e.refreshInterval=60;var n="container"+e.symbol.replace(".","");e.containerID=n,e.yesterdayClosePrice=void 0,e.chart=void 0,e.initGraphPromise=void 0,e.updateGraphPromise=void 0;var s=function(){var r=[e.symbol],t=o.getCurrentDataWithDetails(r);t.then(function(r){if(r.query.count>0){var t=r.query.results.row.PreviousClose;t!==e.yesterdayClosePrice&&(e.yesterdayClosePrice=t,p())}},function(e){s(),e.error!==a.NoData.Error&&console.error(e)})};s();var i=function(r){e.chart=new Highcharts.StockChart({chart:{renderTo:n},title:{text:e.symbol+" Stock Price"},credits:{enabled:!1},rangeSelector:{buttons:[{type:"day",count:1,text:"1d"},{type:"day",count:2,text:"2d"},{type:"day",count:7,text:"5d"},{type:"all",text:"All"}],selected:0,allButtonsEnabled:!0},series:[{name:e.symbol,type:"area",data:r,gapSize:5,tooltip:{valueDecimals:2},fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]},threshold:null}]}),"undefined"!=typeof e.yesterdayClosePrice&&p()},l=function(){v(),i([null]),e.chart.showLoading()};t(l,0);var c=e.symbol.replace(".TO",""),d=e.symbol.indexOf("TO")>-1?"TSE":"NYSE",u=60,h="10d",v=function(){var r=o.getLiveData(c,d,u,h);r.then(function(r){r&&r.length>0?(e.chart.hideLoading(),i(r)):(console.warn('"'+c+'" init did not receive data, refreshing it.'),e.initGraphPromise=t(v,1e3))},function(e){v(),e.error!==a.NoData.Error&&console.error(e)})};e.updateGraph=function(){var r=o.getLiveData(c,d,u,h);r.then(function(r){r&&r.length>0?g(r):(console.warn('"'+c+'" update did not receive data, refreshing it.'),e.updateGraphPromise=t(e.updateGraph,1e3))},function(r){e.updateGraph(),r.error!==a.NoData.Error&&console.error(r)})};var g=function(r){var t=e.chart.series[0];t.setData(r)},p=function(){if("undefined"!=typeof e.chart){var r=e.yesterdayClosePrice,t=e.symbol+"-previousClose",o=e.chart.yAxis[0];o.removePlotLine(t),o.addPlotLine({color:"red",dashStyle:"LongDash",id:t,label:{text:"Prev Close ($"+r+")"},width:1,zIndex:3,value:r})}};e.createRefresher=function(){return r(function(){e.updateGraph()},1e3*e.refreshInterval)},e.createPreviousCloseRefresher=function(){return r(function(){s()},1e3*e.refreshInterval)},e.destroyRefresher=function(){"undefined"!=typeof e.refresher&&(r.cancel(e.refresher),e.refresher=void 0),"undefined"!=typeof e.previousCloseRefresher&&(r.cancel(e.previousCloseRefresher),e.previousCloseRefresher=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()},e.refresher=e.createRefresher(),e.previousCloseRefresher=e.createPreviousCloseRefresher(),e.$on("$destroy",function(){e.destroyRefresher(),"undefined"!=typeof e.initGraphPromise&&(t.cancel(e.initGraphPromise),e.initGraphPromise=void 0),"undefined"!=typeof e.updateGraphPromise&&(t.cancel(e.updateGraphPromise),e.updateGraphPromise=void 0),"undefined"!=typeof e.chart&&e.chart.destroy()})}]),angular.module("stockWatcher.Controllers").controller("StockListController",["$scope","$interval","stockService",function(e,r,t){e.refreshInterval=30,e.sortOrder="index",e.sortReversed=!1,e.quotesToFetch=[{symbol:"PG",yahooSymbol:"PG",liveData:{},index:0},{symbol:"T",yahooSymbol:"T.TO",liveData:{},index:1},{symbol:"BNS",yahooSymbol:"BNS.TO",liveData:{},index:2},{symbol:"TD",yahooSymbol:"TD.TO",liveData:{},index:3},{symbol:"PWF",yahooSymbol:"PWF.TO",liveData:{},index:4},{symbol:"FTS",yahooSymbol:"FTS.TO",liveData:{},index:5},{symbol:"BEP",yahooSymbol:"BEP-UN.TO",liveData:{},index:6},{symbol:"EMA",yahooSymbol:"EMA.TO",liveData:{},index:7},{symbol:"XIC",yahooSymbol:"XIC.TO",liveData:{},index:8},{symbol:"XSP",yahooSymbol:"XSP.TO",liveData:{},index:9}];for(var o=[],a=0,n=e.quotesToFetch.length;n>a;a++)o.push(e.quotesToFetch[a].yahooSymbol);var s=function(){var r=t.getCurrentDataWithDetails(o);r.then(function(r){for(var t=0,o=r.query.count;o>t;t++)e.quotesToFetch[t].liveData=r.query.results.row[t];e.stockQuotes=e.quotesToFetch})};s(),e.createRefresher=function(){return r(function(){s()},1e3*e.refreshInterval)},e.destroyRefresher=function(){"undefined"!=typeof i&&(r.cancel(i),i=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()};var i=e.createRefresher();e.$on("$destroy",function(){e.destroyRefresher()})}]),angular.module("stockWatcher.Controllers").controller("StockListItemController",["$scope","stockService",function(e,r){var t=function(){var t=r.getLiveData(e.quote.symbol,e.quote.exchange,e.quote.interval,e.quote.period);t.then(function(r){e.liveQuotes=r})};t(),e.isGain=function(){if("undefined"!=typeof e.quote.liveData.Change){var r="+"===e.quote.liveData.Change[0];return r}return!1},e.isLoss=function(){if("undefined"!=typeof e.quote.liveData.Change){var r="-"===e.quote.liveData.Change[0];return r}return!1}}]),angular.module("stockWatcher.Directives").directive("currencyChart",function(){return{restrict:"E",scope:{fromCurrency:"@",toCurrency:"@"},templateUrl:"views/currencyChart-partial.html",controller:"CurrencyChartController"}}),angular.module("stockWatcher.Directives").directive("marketChart",function(){return{restrict:"E",scope:{fetchTSX:"@",fetchDJ:"@"},templateUrl:"views/marketChart-partial.html",controller:"MarketChartController"}}),angular.module("stockWatcher.Directives").directive("marketChartWidget",function(){return{restrict:"E",scope:{fetchTSX:"@",fetchDJ:"@"},templateUrl:"views/marketChartWidget-partial.html",controller:"MarketChartWidgetController"}}),angular.module("stockWatcher.Directives").directive("navigationBar",function(){return{restrict:"E",templateUrl:"views/navigationBar-partial.html",controller:"RouteController"}}),angular.module("stockWatcher.Directives").directive("stockChart",function(){return{restrict:"E",scope:{symbol:"@"},templateUrl:"views/stockChart-partial.html",controller:"StockChartController"}}),angular.module("stockWatcher.Directives").directive("stockList",function(){return{restrict:"E",templateUrl:"views/stockList-partial.html",controller:"StockListController"}}),angular.module("stockWatcher.Directives").directive("stockListItem",function(){return{restrict:"A",scope:{quote:"="},templateUrl:"views/stockListItem-partial.html",controller:"StockListItemController"}}),angular.module("stockWatcher.Filters").filter("percentage",["$filter",function(e){return function(r,t){function o(e){return!isNaN(e)&&isFinite(e)}var a=parseFloat(r,10);if(o(a)){var n=e("number")(a,t),s=n+"%";return s}return r}}]),angular.module("stockWatcher.Providers").provider("appConfig",function(){var e={JSONPTimeout:1e4};return{set:function(r,t){e[r]=t},$get:function(){return e}}}),angular.module("stockWatcher.Providers").provider("errorMessages",function(){var e={NoData:{Error:"NoData",Message:"No data received"},Timeout:{Error:"Timeout",Message:"Request took longer than {0}ms"}};return{set:function(r,t){e[r]=t},$get:function(){return e}}}),angular.module("stockWatcher.Services").factory("currencyService",["$q","$http",function(e,r){var t=function(t,o){var a=e.defer(),n='select * from yahoo.finance.xchange where pair in ("'+t+o+'")',s="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",i="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(n)+s;return r.jsonp(i).success(function(e){var r={};e.query.count>0&&(r=e.query.results.rate,r.Ask=parseFloat(r.Ask,10),r.Bid=parseFloat(r.Bid,10),r.Rate=parseFloat(r.Rate,10)),a.resolve(r)}),a.promise},o=function(t,o,a,n){var s=e.defer(),i=0,l="http://www.google.com/finance/getprices?q="+t+o+"&i="+a+"&p="+n+"&f=d,c,v,k,o,h,l&df=cpct&auto=0&ei=Ef6XUYDfCqSTiAKEMg",c='SELECT * FROM csv WHERE url="'+l+'"',d="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(c)+"&format=json&callback=JSON_CALLBACK";return r.jsonp(d).success(function(e){var r=[],t=new Date,o=null!==e.query.results&&e.query.results.row.length>=7;if(e.query&&e.query.count>0&&o){var n=0;e.query.results.row[6]&&(n=parseInt(e.query.results.row[6].col0.replace("TIMEZONE_OFFSET=",""),10));for(var l=parseInt(e.query.results.row[7].col0.replace("a",""),10)+60*n,c=0,d=7;d<e.query.count;d++){"a"===e.query.results.row[d].col0[0]?(l=parseInt(e.query.results.row[d].col0.replace("a",""),10)+60*n,c=0):c=parseInt(e.query.results.row[d].col0,10);var u=new Date(1e3*(l+c*a+60*t.getTimezoneOffset()));if(u>i){var h=parseFloat(e.query.results.row[d].col1,10),v=[u,h];i=u,r.push(v)}}}s.resolve(r)}),s.promise};return{getCurrencyExchangeRate:t,getCurrencyExchangeRateHistory:o}}]),angular.module("stockWatcher.Services").factory("stockService",["$q","$http","$timeout","appConfig","errorMessages",function(e,r,t,o,a){var n=[["a0","Ask"],["a2","AverageDailyVolume"],["a5","AskSize"],["b0","Bid"],["b2","AskRealTime"],["b3","BidRealTime"],["b4","BookValue"],["b6","BidSize"],["c0","ChangeAndPercentChange"],["c1","Change"],["c3","Commission"],["c4","Currency"],["c6","ChangeRealTime"],["c8","AfterHoursChangeRealTime"],["d0","DividendPerShare"],["d1","LastTradeDate"],["d2","TradeDate"],["e0","EarningsPerShare"],["e1","ErrorIndication"],["e7","EPSEstimateCurrentYear"],["e8","EPSEstimateNextYear"],["e9","EPSEstimateNextQuarter"],["h0","DaysHigh"],["j0","_52WeekLow"],["k0","_52WeekHigh"],["g0","DaysLow"],["g1","HoldingsGainPercent"],["g3","AnnualizedGain"],["g4","HoldingsGain"],["g5","HoldingsGainPercentRealTime"],["g6","HoldingsGainRealTime"],["i0","MoreInfo"],["i5","OrderBookRealTime"],["j0","YearLow"],["j1","MarketCapitalization"],["j3","MarketCapRealTime"],["j4","EBITDA"],["j5","ChangeFrom52WeekLow"],["j6","PercentChangeFrom52WeekLow"],["k0","YearHigh"],["k1","LastTradeRealTimeWithTime"],["k2","ChangePercentRealTime"],["k4","ChangeFrom52WeekHigh"],["k5","PercentChangeFrom52WeekHigh"],["l0","LastTradeWithTime"],["l1","LastTradePriceOnly"],["l2","HighLimit"],["l3","LowLimit"],["m0","DaysRange"],["m2","DaysRangeRealTime"],["m3","_50DayMovingAverage"],["m4","_200DayMovingAverage"],["m5","ChangeFrom200DayMovingAverage"],["m6","PercentChangeFrom200DayMovingAverage"],["m7","ChangeFrom50DayMovingAverage"],["m8","PercentChangeFrom50DayMovingAverage"],["n0","Name"],["n4","Notes"],["o0","Open"],["p0","PreviousClose"],["p1","PricePaid"],["p2","ChangeInPercent"],["p5","PricePerSales"],["p6","PricePerBook"],["q0","ExDividendDate"],["r0","PERatio"],["r1","DividendPayDate"],["r2","PERatioRealTime"],["r5","PEGRatio"],["r6","PricePerEPSEstimateCurrentYear"],["r7","PricePerEPSEstimateNextYear"],["s0","Symbol"],["s1","SharesOwned"],["s6","Revenue"],["s7","ShortRatio"],["t1","LastTradeTime"],["t7","TickerTrend"],["t8","_1YearTargetPrice"],["v0","Volume"],["v1","HoldingsValue"],["v7","HoldingsValueRealTime"],["w0","_52WeekRange"],["w1","DaysValueChange"],["w4","DaysValueChangeRealTime"],["x0","StockExchange"],["y0","DividendYield"]],s=function(n,s,i){var l=e.defer(),c=e.defer(),d=!1,u=void 0,h='select * from yahoo.finance.historicaldata where symbol = "'+n+'" and startDate = "'+s+'" and endDate = "'+i+'"',v="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",g="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(h)+v;return r.jsonp(g,{timeout:c.promise}).success(function(e){var r=[];e.query.count>0&&(r=e.query.results.quote),0===e.query.count&&l.reject({error:a.NoData.Error,message:a.NoData.Message}),t.cancel(u),c.reject(),l.resolve(r)}).error(function(e){l.reject(d?{error:a.Timeout.Error,message:a.Timeout.Message.format(o.JSONPTimeout),data:e}:e)}),u=t(function(){d=!0,c.resolve()},o.JSONPTimeout),l.promise},i=function(n){for(var s=e.defer(),i=e.defer(),l=!1,c=void 0,d=[],u=0,h=n.length;h>u;u++)d.push('"'+n[u]+'"');var v="select * from yahoo.finance.quote where symbol in ("+d.join(",")+")",g="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",p="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(v)+g;return r.jsonp(p,{timeout:i.promise}).success(function(e){var r=[];e.query.count>0&&(r=e.query.results.quote),0===e.query.count&&s.reject({error:a.NoData.Error,message:a.NoData.Message}),t.cancel(c),i.reject(),s.resolve(r)}).error(function(e){s.reject(l?{error:a.Timeout.Error,message:a.Timeout.Message.format(o.JSONPTimeout),data:e}:e)}),c=t(function(){l=!0,i.resolve()},o.JSONPTimeout),s.promise},l=function(s){for(var i=e.defer(),l=e.defer(),c=!1,d=void 0,u=s.join(","),h=[],v=[],g=0,p=n.length;p>g;g++){var f=n[g];h.push(f[0]),v.push(f[1])}h=h.join(""),v=v.join(",");var m="http://download.finance.yahoo.com/d/quotes.csv?s="+u+"&f="+h+"&e=.csv",y="select * from csv where url='"+m+"' and columns='"+v+"'",D="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",C="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(y)+D;return r.jsonp(C,{timeout:l.promise}).success(function(e){0===e.query.count&&i.reject({error:a.NoData.Error,message:a.NoData.Message}),t.cancel(d),l.reject(),i.resolve(e)}).error(function(e){i.reject(c?{error:a.Timeout.Error,message:a.Timeout.Message.format(o.JSONPTimeout),data:e}:e)}),d=t(function(){c=!0,l.resolve()},o.JSONPTimeout),i.promise},c=function(n,s,i,l){var c=e.defer(),d=e.defer(),u=!1,h=void 0,v=0,g="http://www.google.com/finance/getprices?q="+n+(null===s?"":"&x="+s)+"&i="+i+"&p="+l+"&f=d,c,v,k,o,h,l&df=cpct&auto=0&ei=Ef6XUYDfCqSTiAKEMg",p='SELECT * FROM csv WHERE url="'+g+'"',f="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(p)+"&format=json&callback=JSON_CALLBACK";return r.jsonp(f,{timeout:d.promise}).success(function(e){var r=[],o=new Date,n=null!==e.query.results&&e.query.results.row.length>=7;if(e.query&&e.query.count>0&&n){var s=0;e.query.results.row[6]&&(s=parseInt(e.query.results.row[6].col0.replace("TIMEZONE_OFFSET=",""),10));for(var l=parseInt(e.query.results.row[7].col0.replace("a",""),10)+60*s,u=0,g=7;g<e.query.count;g++){"a"===e.query.results.row[g].col0[0]?(l=parseInt(e.query.results.row[g].col0.replace("a",""),10)+60*s,u=0):u=parseInt(e.query.results.row[g].col0,10);var p=new Date(1e3*(l+u*i+60*o.getTimezoneOffset()));if(p>v){var f=parseFloat(e.query.results.row[g].col1,10),m=[p,f];v=p,r.push(m)}}}0===r.length&&c.reject({error:a.NoData.Error,message:a.NoData.Message}),t.cancel(h),d.reject(),c.resolve(r)}).error(function(e){c.reject(u?{error:a.Timeout.Error,message:a.Timeout.Message.format(o.JSONPTimeout),data:e}:e)}),h=t(function(){u=!0,d.resolve()},o.JSONPTimeout),c.promise},d=function(e,r,t){return c(e,null,r,t)};return{getHistoricalData:s,getLiveData:c,getLiveMarketData:d,getCurrentData:i,getCurrentDataWithDetails:l}}]),angular.module("stockWatcher").run(["$templateCache",function(e){e.put("views/about-page.html","<h1>About</h1><div>About Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div>"),e.put("views/currency-page.html",'<h1>Currencies</h1><div>Currency Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div><div class="page-header"><h2>Canadian Dollar (CAD)</h2></div><div class="row"><div class="col-sm-6"><currency-chart from-currency="CAD" to-currency="USD"></currency-chart></div><div class="col-sm-6"><currency-chart from-currency="CAD" to-currency="EUR"></currency-chart></div></div><div class="page-header"><h2>US Dollar (USD)</h2></div><div class="row"><div class="col-sm-6"><currency-chart from-currency="USD" to-currency="CAD"></currency-chart></div><div class="col-sm-6"><currency-chart from-currency="USD" to-currency="EUR"></currency-chart></div></div>'),e.put("views/currencyChart-partial.html",'<div id="{{ containerID }}"></div>'),e.put("views/home-page.html",'<h1>Home</h1><div>Home Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div><div><stock-list></stock-list></div><div class="page-header"><h2>Charts</h2></div><div class="row"><div class="col-sm-6"><stock-chart symbol="PG"></stock-chart></div><div class="col-sm-6"><stock-chart symbol="T.TO"></stock-chart></div><div class="col-sm-6"><stock-chart symbol="BNS.TO"></stock-chart></div><div class="col-sm-6"><stock-chart symbol="TD.TO"></stock-chart></div></div><div class="row"><div class="col-sm-6"><market-chart-widget></market-chart-widget></div><div class="col-sm-6"><div class="page-header"><h2>Currencies</h2></div><currency-chart from-currency="CAD" to-currency="USD"></currency-chart></div></div>'),e.put("views/marketChart-partial.html",'<div ng-hide="chartIsInitialized"><div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate text-center"></span> <strong>Loading data...</strong> Chart will display soon.</div></div><div id="{{ containerID }}"></div>'),e.put("views/marketChartWidget-partial.html",'<div class="row"><div class="col-sm-12"><div class="page-header" style="margin-top: 20px;"><div class="row"><div class="col-sm-8"><h2>Market Indices</h2></div><div class="col-sm-4" style="margin-top: 20px;"><div class="dropdown text-right"><button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Config <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1"><li role="presentation" class="small"><a role="menuitem" tabindex="-1" href="javascript:;" ng-click="toggleTitle()"><span class="glyphicon" ng-class="{\'glyphicon-ok\': showTitle, \'glyphicon-none\': !showTitle}" aria-hidden="true"></span> Show Title</a></li><li role="presentation" class="small disabled"><a role="menuitem" tabindex="-1" href="javascript:;" ng-click="toggleZoom()"><span class="glyphicon" ng-class="{\'glyphicon-ok\': showZoom, \'glyphicon-none\': !showZoom}" aria-hidden="true"></span> Show Zoom</a></li><li role="presentation" class="small disabled"><a role="menuitem" tabindex="-1" href="javascript:;" ng-click="toggleDatePicker()"><span class="glyphicon" ng-class="{\'glyphicon-ok\': showDatePicker, \'glyphicon-none\': !showDatePicker}" aria-hidden="true"></span> Show Date Picker</a></li><li role="presentation" class="small"><a role="menuitem" tabindex="-1" href="javascript:;" ng-click="toggleNavigator()"><span class="glyphicon" ng-class="{\'glyphicon-ok\': showNavigator, \'glyphicon-none\': !showNavigator}" aria-hidden="true"></span> Show Navigator</a></li><li class="divider"></li><li role="presentation" class="small disabled"><a role="menuitem" tabindex="-1" href="#">Export Config</a></li><li role="presentation" class="small disabled"><a role="menuitem" tabindex="-1" href="#">Import Config</a></li></ul></div></div></div></div><market-chart fetch-tsx="true" fetch-dj="true"></market-chart></div></div>'),e.put("views/navigationBar-partial.html",'<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#/">Angular StockWatcher</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"><li ng-class="{active: controller == \'HomePageController\'}"><a href="#/">Home</a></li><li ng-class="{active: controller == \'CurrencyPageController\'}"><a href="#/currency">Currencies</a></li><li ng-class="{active: controller == \'AboutPageController\'}"><a href="#/about">About</a></li><li class="disabled"><a href="#contact">Contact</a></li><li class="dropdown disabled"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li><a href="#">Action</a></li><li><a href="#">Another action</a></li><li><a href="#">Something else here</a></li><li class="divider"></li><li class="dropdown-header">Nav header</li><li><a href="#">Separated link</a></li><li><a href="#">One more separated link</a></li></ul></li></ul></div></div></nav>'),e.put("views/quoteDetails-page.html",'<h1>Quote Details</h1><div>Quote Details Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div><div class="page-header"><h2>{{ stockData.Name }} ({{ stockData.Symbol }})</h2></div><div class="row"><div class="col-sm-4"><table class="table table-striped table-condensed"><tbody><tr><td><strong>Previous Close:</strong></td><td class="text-right">{{ stockData.PreviousClose | currency }}</td></tr><tr><td><strong>Open:</strong></td><td class="text-right">{{ stockData.Open | currency }}</td></tr><tr><td><strong>Currency:</strong></td><td class="text-right">{{ stockData.Currency }}</td></tr><tr><td><strong>Bid (Real-time):</strong></td><td class="text-right">{{ stockData.BidRealTime | currency }}</td></tr><tr><td><strong>Ask (Real-time):</strong></td><td class="text-right">{{ stockData.AskRealTime | currency }}</td></tr><tr><td><strong>1-Year Target Estimate:</strong></td><td class="text-right">{{ stockData._1YearTargetPrice | currency }}</td></tr><tr><td><strong>Day\'s Range:</strong></td><td class="text-right">{{ stockData.DaysLow | currency }} - {{ stockData.DaysHigh | currency }}</td></tr><tr><td><strong>52-Week Range:</strong></td><td class="text-right">{{ stockData._52WeekLow | currency }} - {{ stockData._52WeekHigh | currency }}</td></tr><tr><td><strong>Volume:</strong></td><td class="text-right">{{ stockData.Volume | number }}</td></tr><tr><td><strong>Average Daily Volume:</strong></td><td class="text-right">{{ stockData.AverageDailyVolume | number }}</td></tr><tr><td><strong>Market Capitalization:</strong></td><td class="text-right">{{ stockData.MarketCapitalization }}</td></tr><tr><td><strong>P/E (ttm) (Real-time):</strong></td><td class="text-right">{{ stockData.PERatioRealTime }}</td></tr><tr><td><strong>EPS (ttm):</strong></td><td class="text-right">{{ stockData.EarningsPerShare }}</td></tr><tr><td><strong>Last Trade Date:</strong></td><td class="text-right">{{ stockData.LastTradeDate }}</td></tr><tr><td><strong>Ex-Dividend Date:</strong></td><td class="text-right">{{ stockData.ExDividendDate }}</td></tr><tr><td><strong>Dividend Pay Date:</strong></td><td class="text-right">{{ stockData.DividendPayDate }}</td></tr><tr><td><strong>Dividend Yield:</strong></td><td class="text-right">{{ stockData.DividendYield }}</td></tr></tbody></table></div><div class="col-sm-8"><stock-chart symbol="{{ $location.path().replace(\'/quote/\', \'\') }}"></stock-chart></div></div>'),e.put("views/stockChart-partial.html",'<div id="{{ containerID }}"></div>'),e.put("views/stockList-partial.html",'<div class="page-header"><div class="row"><div class="col-sm-8"><h2>Watchlist</h2></div><div class="col-sm-4"><form class="form-horizontal" role="form"><div class="form-group form-group-sm"><label class="col-sm-8 control-label" for="refreshInterval">Refresh interval:</label><div class="col-sm-4"><select id="refreshInterval" class="form-control" ng-model="refreshInterval" ng-change="refreshIntervalChanged()"><option value="30">30 sec</option><option value="60">60 sec</option><option value="300">5 min</option><option value="900">15 min</option></select></div></div></form></div></div></div><div class="row"><div class="table-responsive"><table class="table table-striped table-hover table-condensed"><thead><tr><th ng-click="sortOrder = \'index\'; sortReversed = !sortReversed;"># <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'index\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'index\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.Symbol\'; sortReversed = !sortReversed;">Symbol <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.Symbol\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.Symbol\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.Name\'; sortReversed = !sortReversed;">Name <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.Name\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.Name\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.LastTradePriceOnly\'; sortReversed = !sortReversed;">Trade Price <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.LastTradePriceOnly\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.LastTradePriceOnly\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.Change\'; sortReversed = !sortReversed;">Change <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.Change\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.Change\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.ChangeInPercent\'; sortReversed = !sortReversed;">% Change <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.ChangeInPercent\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.ChangeInPercent\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.DividendYield\'; sortReversed = !sortReversed;">Yield <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.DividendYield\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.DividendYield\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.PERatio\'; sortReversed = !sortReversed;">P/E <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.PERatio\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.PERatio\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.EarningsPerShare\'; sortReversed = !sortReversed;">EPS <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.EarningsPerShare\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.EarningsPerShare\' && sortReversed === true}" aria-hidden="true"></span></th><th colspan="2" ng-click="sortOrder = \'liveData._52WeekLow\'; sortReversed = !sortReversed;">52 week-Range <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData._52WeekLow\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData._52WeekLow\' && sortReversed === true}" aria-hidden="true"></span></th><th ng-click="sortOrder = \'liveData.StockExchange\'; sortReversed = !sortReversed;">Ex <span class="glyphicon-lighter small" ng-class="{\'glyphicon glyphicon-chevron-up\' : sortOrder === \'liveData.StockExchange\' && sortReversed === false, \'glyphicon glyphicon-chevron-down\' : sortOrder === \'liveData.StockExchange\' && sortReversed === true}" aria-hidden="true"></span></th><th>See more</th></tr></thead><tbody><tr stock-list-item class="animate-repeat" ng-repeat="quote in stockQuotes | orderBy:sortOrder:sortReversed" quote="quote" ng-hide="typeof stockQuotes === \'undefined\'"></tr><tr ng-hide="stockQuotes.length > 0"><td colspan="13" class="text-center"><strong>Loading data...</strong></td></tr></tbody></table></div></div>'),e.put("views/stockListItem-partial.html",'<td class="text-right">{{ quote.index + 1 }}</td><td>{{ quote.liveData.Symbol }}</td><td>{{ quote.liveData.Name }}</td><td class="text-right">{{ quote.liveData.LastTradePriceOnly | currency }} {{ quote.liveData.Currency }}</td><td class="text-right" ng-class="isGain() ? \'text-success\' : (isLoss() ? \'text-danger\' : \'\')">{{ quote.liveData.Change | currency }}</td><td class="text-right" ng-class="isGain() ? \'text-success\' : (isLoss() ? \'text-danger\' : \'\')">{{ quote.liveData.ChangeInPercent | percentage:2 }}</td><td class="text-right">{{ quote.liveData.DividendYield | percentage:2 }}</td><td class="text-right">{{ quote.liveData.PERatio }}</td><td class="text-right">{{ quote.liveData.EarningsPerShare | number:2 }}</td><td class="text-right">{{ quote.liveData._52WeekLow | currency }}</td><td class="text-right">{{ quote.liveData._52WeekHigh | currency }}</td><td>{{ quote.liveData.StockExchange }}</td><td><a href="#/quote/{{ quote.yahooSymbol }}" class="btn btn-default btn-xs" role="button" title="See details about {{ quote.symbol }}"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Details</a></td>')
}]);