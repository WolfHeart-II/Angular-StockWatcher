"use strict";angular.module("myApp",["ngRoute","myApp.HomePageController","myApp.AboutPageController","myApp.NavigationBarDirective","myApp.RouteController","myApp.StockService","myApp.StockListDirective","myApp.StockListController","myApp.StockListItemDirective","myApp.StockListItemController","myApp.StockListPercentageFilter","myApp.QuoteDetailsPageController"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/home-page.html",controller:"HomePageController"}).when("/about",{templateUrl:"views/about-page.html",controller:"AboutPageController"}).when("/quote/:stockSymbol",{templateUrl:"views/quoteDetails-page.html",controller:"QuoteDetailsPageController"}).otherwise({redirectTo:"/"})}]),angular.module("myApp.AboutPageController",[]).controller("AboutPageController",["$scope",function(e){e.controllerVersion="0.0.1"}]),angular.module("myApp.HomePageController",[]).controller("HomePageController",["$scope",function(e){e.controllerVersion="0.0.1"}]),angular.module("myApp.QuoteDetailsPageController",[]).controller("QuoteDetailsPageController",["$scope","$interval","$routeParams","stockService",function(e,t,a,r){e.controllerVersion="0.0.1",e.stockSymbol=a.stockSymbol,e.refreshInterval=30;var o=function(){var t=[e.stockSymbol],a=r.getCurrentDataWithDetails(t);a.then(function(t){console.log(t);for(var a=[],r=Object.keys(t),o=0,l=r.length;l>o;o++){var n=r[o],i=[n,t[n]];a.push(i)}e.stockData=a})};e.createRefresher=function(){return t(function(){o()},1e3*e.refreshInterval)},e.destroyRefresher=function(){angular.isDefined(l)&&(t.cancel(l),l=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()};var l=e.createRefresher();e.$on("$destroy",function(){e.destroyRefresher()})}]),angular.module("myApp.RouteController",[]).controller("RouteController",["$scope","$route","$location",function(e,t){e.$on("$routeChangeSuccess",function(){e.controller=t.current.controller})}]),angular.module("myApp.StockListController",[]).controller("StockListController",["$scope","$interval","stockService",function(e,t,a){e.refreshInterval=30;var r=[{symbol:"PG",yahooSymbol:"PG",exchange:"NYSE",interval:900,period:"10d",liveData:{}},{symbol:"T",yahooSymbol:"T.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"BNS",yahooSymbol:"BNS.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"TD",yahooSymbol:"TD.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"PWF",yahooSymbol:"PWF.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"FTS",yahooSymbol:"FTS.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"BEP",yahooSymbol:"BEP-UN.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"EMA",yahooSymbol:"EMA.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"XIC",yahooSymbol:"XIC.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}},{symbol:"XSP",yahooSymbol:"XSP.TO",exchange:"TSE",interval:900,period:"1d",liveData:{}}];e.stockQuotes=r;var o="T",l="TSE",n=900,i="1d",s=function(){var t=a.getLiveData(o,l,n,i);t.then(function(t){e.liveQuotes=t})};s();for(var c=[],u=0,h=r.length;h>u;u++)c.push(r[u].yahooSymbol);var d=function(){var t=a.getCurrentData(c);t.then(function(t){console.log(t);for(var a=0,r=t.length;r>a;a++){var o=t[a],l=o.LastTradePriceOnly-o.Change,n=o.Change/l;o.ChangePercentage=n,e.stockQuotes[a].liveData=o}})};d();var v=function(){var e=a.getCurrentDataWithDetails(["PG"]);e.then(function(e){console.log(e)})};v(),e.createRefresher=function(){return t(function(){d()},1e3*e.refreshInterval)},e.destroyRefresher=function(){angular.isDefined(m)&&(t.cancel(m),m=void 0)},e.refreshIntervalChanged=function(){e.destroyRefresher(),e.createRefresher()};var m=e.createRefresher();e.$on("$destroy",function(){e.destroyRefresher()})}]),angular.module("myApp.StockListItemController",[]).controller("StockListItemController",["$scope","stockService",function(e,t){var a=function(){var a=t.getLiveData(e.quote.symbol,e.quote.exchange,e.quote.interval,e.quote.period);a.then(function(t){e.liveQuotes=t})};a(),e.isGain=function(){if("undefined"!=typeof e.quote.liveData.Change){var t="+"===e.quote.liveData.Change[0];return t}return!1},e.isLoss=function(){if("undefined"!=typeof e.quote.liveData.Change){var t="-"===e.quote.liveData.Change[0];return t}return!1}}]),angular.module("myApp.NavigationBarDirective",[]).directive("navigationBar",function(){return{restrict:"E",templateUrl:"views/navigationBar-partial.html",controller:"RouteController"}}),angular.module("myApp.StockListDirective",[]).directive("stockList",function(){return{restrict:"E",templateUrl:"views/stockList-partial.html",controller:"StockListController"}}),angular.module("myApp.StockListItemDirective",[]).directive("stockListItem",function(){return{restrict:"A",scope:{quote:"="},templateUrl:"views/stockListItem-partial.html",controller:"StockListItemController"}}),angular.module("myApp.StockListPercentageFilter",[]).filter("percentage",["$filter",function(e){return function(t,a){var r=e("number")(100*t,a),o=(r>0?"+":"")+r+"%";return o}}]),angular.module("myApp.StockService",[]).factory("stockService",["$q","$http",function(e,t){var a=[["a","Ask"],["a2","AverageDailyVolume"],["a5","AskSize"],["b","Bid"],["b2","AskRealTime"],["b3","BidRealTime"],["b4","BookValue"],["b6","BidSize"],["c","ChangeAndPercentChange"],["c1","Change"],["c3","Commission"],["c6","ChangeRealTime"],["c8","AfterHoursChangeRealTime"],["d","DividendPerShare"],["d1","LastTradeDate"],["d2","TradeDate"],["e","EarningsPerShare"],["e1","ErrorIndication"],["e7","EPSEstimateCurrentYear"],["e8","EPSEstimateNextYear"],["e9","EPSEstimateNextQuarter"],["f6","FloatShares"],["g","DaysLow"],["h","DaysHigh"],["j","52WeekLow"],["k","52WeekHigh"],["g1","HoldingsGainPercent"],["g3","AnnualizedGain"],["g4","HoldingsGain"],["g5","HoldingsGainPercentRealTime"],["g6","HoldingsGainRealTime"],["i","MoreInfo"],["i5","OrderBookRealTime"],["j1","MarketCapitalization"],["j3","MarketCapRealTime"],["j4","EBITDA"],["j5","ChangeFrom52WeekLow"],["j6","PercentChangeFrom52WeekLow"],["k1","LastTradeRealTimeWithTime"],["k2","ChangePercentRealTime"],["k3","LastTradeSize"],["k4","ChangeFrom52WeekHigh"],["k5","PercentChangeFrom52WeekHigh"],["l","LastTradeWithTime"],["l1","LastTradePriceOnly"],["l2","HighLimit"],["l3","LowLimit"],["m","DaysRange"],["m2","DaysRangeRealTime"],["m3","50DayMovingAverage"],["m4","200DayMovingAverage"],["m5","ChangeFrom200DayMovingAverage"],["m6","PercentChangeFrom200DayMovingAverage"],["m7","ChangeFrom50DayMovingAverage"],["m8","PercentChangeFrom50DayMovingAverage"],["n","Name"],["n4","Notes"],["o","Open"],["p","PreviousClose"],["p1","PricePaid"],["p2","ChangeInPercent"],["p5","PricePerSales"],["p6","PricePerBook"],["q","ExDividendDate"],["r","PERatio"],["r1","DividendPayDate"],["r2","PERatioRealTime"],["r5","PEGRatio"],["r6","PricePerEPSEstimateCurrentYear"],["r7","PricePerEPSEstimateNextYear"],["s","Symbol"],["s1","SharesOwned"],["s7","ShortRatio"],["t1","LastTradeTime"],["t6","TradeLinks"],["t7","TickerTrend"],["t8","1YearTargetPrice"],["v","Volume"],["v1","HoldingsValue"],["v7","HoldingsValueRealTime"],["w","52WeekRange"],["w1","DaysValueChange"],["w4","DaysValueChangeRealTime"],["x","StockExchange"],["y","DividendYield"]],r=function(a,r,o){var l=e.defer(),n='select * from yahoo.finance.historicaldata where symbol = "'+a+'" and startDate = "'+r+'" and endDate = "'+o+'"',i="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",s="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(n)+i;return t.jsonp(s).success(function(e){var t=[];e.query.count>0&&(t=e.query.results.quote),l.resolve(t)}),l.promise},o=function(a){for(var r=e.defer(),o=[],l=0,n=a.length;n>l;l++)o.push('"'+a[l]+'"');var i="select * from yahoo.finance.quote where symbol in ("+o.join(",")+")",s="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",c="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(i)+s;return t.jsonp(c).success(function(e){var t=[];e.query.count>0&&(t=e.query.results.quote),r.resolve(t)}),r.promise},l=function(r){for(var o=e.defer(),l=r.join(","),n=[],i=0,s=a.length;s>i;i++)n.push(a[i][0]);n=n.join("");var c="http://download.finance.yahoo.com/d/quotes.csv?s="+l+"&f="+n+"&e=.csv",u="select * from csv where url='"+c+"'",h="&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=JSON_CALLBACK",d="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(u)+h;return t.jsonp(d).success(function(e){for(var t={},r=a.length-1;r>=0;r--){var l=a[r][1],n=e.query.results.row["col"+(r+3)];t[l]=n}o.resolve(t)}),o.promise},n=function(a,r,o,l){var n=e.defer(),i=0,s="http://www.google.com/finance/getprices?q="+a+"&x="+r+"&i="+o+"&p="+l+"&f=d,c,v,k,o,h,l&df=cpct&auto=0&ei=Ef6XUYDfCqSTiAKEMg",c='SELECT * FROM csv WHERE url="'+s+'"',u="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(c)+"&format=json&callback=JSON_CALLBACK";return t.jsonp(u).success(function(e){var t=[],a=new Date,r=null!==e.query.results&&e.query.results.row.length>=7;if(e.query&&e.query.count>0&&r){var l=0;e.query.results.row[6]&&(l=parseInt(e.query.results.row[6].col0.replace("TIMEZONE_OFFSET=",""),10));for(var s=parseInt(e.query.results.row[7].col0.replace("a",""),10)+60*l,c=0,u=7;u<e.query.count;u++){"a"===e.query.results.row[u].col0[0]?(s=parseInt(e.query.results.row[u].col0.replace("a",""),10)+60*l,c=0):c=parseInt(e.query.results.row[u].col0,10);var h=new Date(1e3*(s+c*o+60*a.getTimezoneOffset()));if(h>i){var d=parseFloat(e.query.results.row[u].col1),v=[h,d];i=h,t.push(v)}}}n.resolve(t)}),n.promise};return{getHistoricalData:r,getLiveData:n,getCurrentData:o,getCurrentDataWithDetails:l}}]),angular.module("myApp").run(["$templateCache",function(e){e.put("views/about-page.html","<h1>About</h1><div>About Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div>"),e.put("views/home-page.html","<h1>Home</h1><div>Home Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div><div><stock-list></stock-list></div>"),e.put("views/navigationBar-partial.html",'<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#">Angular StockWatcher</a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav"><li ng-class="{active: controller == \'HomePageController\'}"><a href="#/home">Home</a></li><li ng-class="{active: controller == \'AboutPageController\'}"><a href="#/about">About</a></li><li><a href="#contact">Contact</a></li><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li><a href="#">Action</a></li><li><a href="#">Another action</a></li><li><a href="#">Something else here</a></li><li class="divider"></li><li class="dropdown-header">Nav header</li><li><a href="#">Separated link</a></li><li><a href="#">One more separated link</a></li></ul></li></ul></div></div></nav>'),e.put("views/quoteDetails-page.html",'<h1>{{ stockSymbol }} Quote Details</h1><div>Quote Details Page for <em>Angular StockWatcher</em> (Controller v.{{ controllerVersion }})</div><div><ul><li ng-repeat="data in stockData"><strong>{{ data[0] }}</strong>: {{ data[1] }}</li></ul></div>'),e.put("views/stockList-partial.html",'<div class="page-header"><div class="row"><div class="col-sm-8"><h2>Watchlist</h2></div><div class="col-sm-4"><form class="form-horizontal" role="form"><div class="form-group form-group-sm"><label class="col-sm-8 control-label" for="refreshInterval">Refresh interval:</label><div class="col-sm-4"><select id="refreshInterval" class="form-control" ng-model="refreshInterval" ng-change="refreshIntervalChanged()"><option value="30">30 sec</option><option value="60">60 sec</option><option value="300">5 min</option><option value="900">15 min</option></select></div></div></form></div></div></div><div class="row"><table class="table table-striped table-condensed"><thead><tr><th>Symbol</th><th>Name</th><th>Trade</th><th>Change</th><th>Change</th><th>Day\'s High</th><th>Day\'s Low</th><th>Year-High</th><th>Year-Low</th><th>Ex</th><th>Vol.</th><th>Mkt. Cap.</th><th>Avg. Dly. Vol.</th><th>See more</th></tr></thead><tbody><tr stock-list-item ng-repeat="quote in stockQuotes" quote="quote"></tr></tbody></table></div><div class="row"><table class="table table-striped"><thead><tr><th>Date</th><th>Value</th></tr></thead><tbody><tr ng-repeat="quote in liveQuotes"><td>{{ quote[0] | date:"MM/dd/yyyy @ hh:mma" }}</td><td>{{ quote[1] | currency }}</td></tr></tbody></table></div>'),e.put("views/stockListItem-partial.html",'<td>{{ quote.symbol }}</td><td>{{ quote.liveData.Name }}</td><td class="text-right">{{ quote.liveData.LastTradePriceOnly | currency }}</td><td class="text-right" ng-class="isGain() ? \'text-success\' : (isLoss() ? \'text-danger\' : \'\')">{{ quote.liveData.Change | currency }}</td><td class="text-right" ng-class="isGain() ? \'text-success\' : (isLoss() ? \'text-danger\' : \'\')">{{ quote.liveData.ChangePercentage | percentage:2 }}</td><td class="text-right">{{ quote.liveData.DaysHigh | currency }}</td><td class="text-right">{{ quote.liveData.DaysLow | currency }}</td><td class="text-right">{{ quote.liveData.YearHigh | currency }}</td><td class="text-right">{{ quote.liveData.YearLow | currency }}</td><td>{{ quote.liveData.StockExchange }}</td><td class="text-right">{{ quote.liveData.Volume | number }}</td><td class="text-right">{{ quote.liveData.MarketCapitalization }}</td><td class="text-right">{{ quote.liveData.AverageDailyVolume | number }}</td><td><a href="#/quote/{{ quote.symbol }}" class="btn btn-default btn-xs" role="button" title="See details about {{ quote.symbol }}"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Details</a></td>')}]);